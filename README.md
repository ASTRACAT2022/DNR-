
# ASTRACAT DNR: Рекурсивный DNS-Сервер

`ASTRACAT DNR` — это рекурсивный DNS-сервер. Он предназначен для быстрого разрешения DNS-имён путём выполнения полной рекурсивной цепочки запросов.

## Особенности

*   **Рекурсивный резолвер:** Самостоятельно проходит путь от корневых DNS-серверов до authoritative серверов для получения ответа.
*   **Кэширование:** Сохраняет результаты запросов в памяти, учитывая TTL (Time To Live) для повышения производительности.
*   **Предзапросы (Proactive Refresh):** Активно обновляет записи в кэше до истечения их срока жизни, чтобы минимизировать задержки для клиентов.
*   **Настраиваемый:** Поддерживает широкий спектр параметров командной строки для тонкой настройки поведения.
*   **Логирование:** Использует `syslog` для записи логов и статистики.

## Установка

Есть два способа установки: автоматический (рекомендуется) и ручной.

### 1. Автоматическая установка (с помощью скрипта)

Для большинства дистрибутивов Linux (Debian, Ubuntu, CentOS, Fedora) вы можете использовать скрипт `setup.sh` для автоматической установки зависимостей, сборки и настройки сервиса.

```bash
sudo ./setup.sh
```

Скрипт выполнит все необходимые шаги за вас.

### 2. Ручная установка

Если вы хотите контролировать процесс установки, следуйте этим шагам.

#### Шаг 1: Установка зависимостей

Вам потребуются `git`, компилятор C++ (`g++` или `clang++`) и `autotools`.

*   **Для Debian/Ubuntu:**
    ```bash
    sudo apt-get update
    sudo apt-get install -y build-essential autoconf automake libtool
    ```
*   **Для CentOS/Fedora/RHEL:**
    ```bash
    sudo dnf install -y gcc-c++ make autoconf automake libtool git
    ```

#### Шаг 2: Сборка

1.  **Подготовьте сборочное окружение:**
    ```bash
    autoreconf -fiv
    ```
2.  **Настройте проект:**
    ```bash
    # Установка в /usr/local (стандарт)
    ./configure
    # Для установки в /usr
    # ./configure --prefix=/usr
    ```
3.  **Скомпилируйте программу:**
    ```bash
    make
    ```

#### Шаг 3: Установка

1.  **Установите бинарный файл и сервис systemd:**
    ```bash
    sudo make install
    ```
    Эта команда скопирует исполняемый файл `DNR` в (по умолчанию) `/usr/local/bin` и файл сервиса `dnr.service` в (по умолчанию) `/lib/systemd/system`.

2.  **Перезагрузите конфигурацию systemd:**
    ```bash
    sudo systemctl daemon-reload
    ```

## Управление сервисом (systemd)

После установки вы можете управлять сервисом `DNR` с помощью `systemctl`:

*   **Запустить сервис:**
    ```bash
    sudo systemctl start dnr
    ```
*   **Включить автозапуск при загрузке системы:**
    ```bash
    sudo systemctl enable dnr
    ```
*   **Проверить статус:**
    ```bash
    sudo systemctl status dnr
    ```
*   **Остановить сервис:**
    ```bash
    sudo systemctl stop dnr
    ```
*   **Просмотреть логи в реальном времени:**
    ```bash
    journalctl -u dnr -f
    ```

## Конфигурация

Все параметры `DNR` можно настроить через аргументы командной строки.

### Параметры командной строки

Чтобы увидеть все опции, запустите: `/usr/local/bin/DNR -h`.

*   `-b <address>`: IP-адрес для прослушивания (по умолчанию: `0.0.0.0`).
*   `-p <port>`: Порт для прослушивания (по умолчанию: `53`).
*   ... (и другие параметры)

Чтобы изменить параметры для сервиса systemd, отредактируйте файл `/lib/systemd/system/dnr.service` и измените строку `ExecStart`. После этого перезапустите сервис:

```bash
sudo systemctl daemon-reload
sudo systemctl restart dnr
```

### Тестирование

Используйте `dig` для проверки работы сервера:

```bash
# Запрос к серверу, работающему на порту 53
dig @127.0.0.1 example.com
```

---
